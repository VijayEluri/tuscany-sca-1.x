<?xml version="1.0" encoding="UTF-8"?>
<process 
    name="Pong"
    targetNamespace="http://tuscany.apache.org/implementation/bpel/example/pong"
    xmlns="http://schemas.xmlsoap.org/ws/2004/03/business-process/"
    xmlns:bpws="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:pong="http://tuscany.apache.org/implementation/bpel/example/pong.wsdl" 
    xmlns:tns="http://tuscany.apache.org/implementation/bpel/example/pong" 
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    exitOnStandardFault="yes"
    expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">

    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="pong.wsdl" namespace="http://tuscany.apache.org/implementation/bpel/example/pong.wsdl"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="pong.wsdl" namespace="http://tuscany.apache.org/implementation/bpel/example/pong.wsdl"/>
    <partnerLinks>
        <partnerLink myRole="Provider" name="PongPartnerLink" partnerLinkType="pong:PongPartnerLinkType"/>
    </partnerLinks>
    <variables>
        <variable messageType="pong:PongRequest" name="pongRequest"/>
        <variable messageType="pong:PongResponse" name="pongResponse"/>
        <variable name="text" type="xsd:string"/>
    </variables>
    <sequence name="Main">
        <receive createInstance="yes" name="pongReceive"
            operation="Pong" partnerLink="PongPartnerLink"
            portType="pong:PongPortType" variable="pongRequest"/>
        <assign name="assignPongRequest" validate="no">
            <copy>
                <from><![CDATA[concat($pongRequest.body/pong:text, ' pong')]]></from>
                <to><![CDATA[$text]]></to>
            </copy>
            <copy>
                <from>
                    <literal>
                        <pong:PongRequest xmlns:pong="urn:/Pong.wsdl">
                            <pong:text/>
                        </pong:PongRequest>
                    </literal>
                </from>
                <to><![CDATA[$pongResponse.body]]></to>
            </copy>
            <copy>
                <from><![CDATA[$text]]></from>
                <to><![CDATA[$pongResponse.body/pong:text]]></to>
            </copy>
        </assign>
        <reply name="pongReply" operation="Pong"
            partnerLink="PongPartnerLink" portType="pong:PongPortType" variable="pongResponse"/>
    </sequence>
</process>
