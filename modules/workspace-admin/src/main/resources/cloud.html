<!--
    * Licensed to the Apache Software Foundation (ASF) under one
    * or more contributor license agreements.  See the NOTICE file
    * distributed with this work for additional information
    * regarding copyright ownership.  The ASF licenses this file
    * to you under the Apache License, Version 2.0 (the
    * "License"); you may not use this file except in compliance
    * with the License.  You may obtain a copy of the License at
    * 
    *   http://www.apache.org/licenses/LICENSE-2.0
    * 
    * Unless required by applicable law or agreed to in writing,
    * software distributed under the License is distributed on an
    * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    * KIND, either express or implied.  See the License for the
    * specific language governing permissions and limitations
    * under the License.    
-->
<html>
<head>
<title>SCA Domain - Node Cloud</title>

<script type="text/javascript" src="cloud.js"></script>
<script type="text/javascript" src="utils.js"></script>

<script language="JavaScript">

	//@Reference
	var cloudComposite = new Reference("cloudComposite");
	
	function getComposites() {
		cloudComposite.get("", getCompositesResponse);
	}
	
	function contributionURI(id) {
	       var i = id.indexOf(';');
	       return id.substring(10, i);
	}
	
	function compositeName(id) {
	       var i = id.indexOf(';');
	       return id.substring(i + 1);
	}
	
	function getCompositesResponse(feed) {
		if (feed != null) {
			var entries = feed.getElementsByTagName("entry");              
			var composites = "";
			composites += '<table border="0" valign="bottom">';
			for (var i=0; i<entries.length; i++) {
				var id = entries[i].getElementsByTagName("id")[0].firstChild.nodeValue;
				var location = entries[i].getElementsByTagName("link")[0].getAttribute("href");
				var uri = contributionURI(id);
				var qname = compositeName(id);
				
				composites += '<tr valign="bottom">'
				composites += '<td><input name="composites" type="checkbox" value="' + id + '">' +
											'<a href=\"' + location + '\">' + uri + ' - ' + qname + '</a></td>';
				composites += '</tr>';
			}
			composites += '</table>';
			document.getElementById("composites").innerHTML = composites;
		}
	}

	function deleteComposite() {
		var composites  = array(document.cloudCompositeForm.composites);
		for (var i = 0; i < composites.length; i++) {
			if (composites[i].checked) {
			    var id = composites[i].value;
				cloudComposite.del(id, deleteCompositeResponse);
			}
		}
	}

	function deleteCompositeResponse() {
	    getComposites();
	}	

	function addComposite() {
		var id  = 'composite:' +
			document.newCompositeForm.contributionURI.value + ';' +
			document.newCompositeForm.compositeNamespace.value + ';' +
			document.newCompositeForm.compositeName.value;
		var entry = '<entry xmlns="http://www.w3.org/2005/Atom">' +
				'<title>' + id +'</title>' +
              	'<id>' + id + '</id>' +
               	'</entry>';
		cloudComposite.post(entry, addCompositeResponse);
	}

	function addCompositeResponse() {
		document.newCompositeForm.compositeQName.value = "";
		document.newCompositeForm.contributionURI.value = "";
	    getComposites();
	}	

	getComposites();

</script>

</head>

<body onload="toolbar()">
  <div id="toolbar"></div>

  <div id="cloudComposite">
  <p style="font-size:150%">
  <b>SCA Domain</b><br><br><b>Node Cloud</b>&nbsp;<a href="/cloud/"><img src="icons/feed-icon.png" border="0"></a>
  </p>
  Here are the SCA composites describing the SCA nodes currently in your SCA node cloud.<br>
  SCA nodes are described as special SCA components of type "implementation.node".
  <br><br>
  
  <form name="cloudCompositeForm">
    <div id="composites" ></div>
    <br/>
    <input type="button" onClick="startComposite()"  value="Start" />
    <input type="button" onClick="stopComposite()"  value="Stop" />
    &nbsp;&nbsp;
    <input type="button" onClick="deleteComposite()"  value="Delete" />
  </form>
  <br/>
  
  <p><b>Add Nodes</b>
  </p>
  Add a composite describing one ore more SCA nodes to add to the cloud.
  <br><br>
  
  <form name="newCompositeForm">
    <table border="0">
    <tr><td>Contribution URI:</td><td><input type="text" name="contributionURI" /></td></td><td>e.g. mycontrib, http:/mycontrib</td></tr>
    <tr><td>Composite Namespace:</td><td><input type="text" name="compositeNamespace" /></td><td>e.g. http://my/namespace</td></tr> 
    <tr><td>Composite Name:</td><td><input type="text" name="compositeName" /></td><td>e.g. mycomposite</td></tr> 
    </table>
    <br/>
    <input type="button" onClick="addComposite()" value="Add" />
  </form>
  
  </div>
</body>

</html>
